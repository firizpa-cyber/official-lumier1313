/**
 * Professional Video Player - Ð¯Ð´Ñ€Ð¾ ÐŸÐ»ÐµÐµÑ€Ð°
 * YouTube-Style Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°
 * 
 * @version 3.0.0 - YouTube Optimized
 * @license MIT
 */

class ProVideoPlayer {
    constructor(config = {}) {
        this.config = {
            videoElement: config.videoElement || 'video',
            container: config.container || null,
            autoplay: config.autoplay || false,
            onReady: config.onReady || null,
            onError: config.onError || null,
        };

        this.video = typeof this.config.videoElement === 'string'
            ? document.getElementById(this.config.videoElement)
            : this.config.videoElement;

        if (!this.video) throw new Error('Ð’Ð¸Ð´ÐµÐ¾ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½');

        this.container = this.config.container
            ? (typeof this.config.container === 'string'
                ? document.getElementById(this.config.container)
                : this.config.container)
            : this.video.parentElement;

        this.state = {
            isPlaying: false,
            currentTime: 0,
            duration: 0,
            volume: 1,
            muted: false,
            quality: 'auto',
            currentQuality: null,
            availableQualities: [],
            buffered: [],
        };

        this.hls = null;
        this.dash = null;
        this.currentEngine = null;
        this.eventHandlers = new Map();

        this.init();
    }

    init() {
        this.setupVideoListeners();
        if (this.config.onReady) this.config.onReady(this);
        this.emit('ready');
    }

    setupVideoListeners() {
        this.video.addEventListener('play', () => {
            this.state.isPlaying = true;
            this.emit('play');
        });

        this.video.addEventListener('pause', () => {
            this.state.isPlaying = false;
            this.emit('pause');
        });

        this.video.addEventListener('timeupdate', () => {
            this.state.currentTime = this.video.currentTime;
            this.emit('timeupdate', this.state.currentTime);
        });

        this.video.addEventListener('loadedmetadata', () => {
            this.state.duration = this.video.duration;
            this.emit('loadedmetadata');
        });

        this.video.addEventListener('volumechange', () => {
            this.state.volume = this.video.volume;
            this.state.muted = this.video.muted;
            this.emit('volumechange');
        });

        this.video.addEventListener('progress', () => {
            this.updateBuffered();
            this.emit('progress');
        });

        this.video.addEventListener('waiting', () => this.emit('waiting'));
        this.video.addEventListener('playing', () => this.emit('playing'));

        this.video.addEventListener('error', (e) => {
            const error = { code: this.video.error?.code, message: this.video.error?.message };
            if (this.config.onError) this.config.onError(error);
            this.emit('error', error);
        });
    }

    loadSource(url, type = 'auto') {
        if (type === 'auto') type = this.detectSourceType(url);
        console.log(`[Player] Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°: ${url} (${type})`);

        this.cleanup();

        switch (type) {
            case 'hls': this.loadHLS(url); break;
            case 'dash': this.loadDASH(url); break;
            default: this.loadNative(url); break;
        }

        this.emit('sourcechange', { url, type });
    }

    detectSourceType(url) {
        if (url.includes('proxy.php?url=')) {
            try {
                const match = url.match(/[?&]url=([^&]+)/);
                if (match) return this.detectSourceType(decodeURIComponent(match[1]));
            } catch (e) { }
        }

        const ext = url.split('?')[0].split('.').pop().toLowerCase();
        if (ext === 'm3u8') return 'hls';
        if (ext === 'mpd') return 'dash';
        if (ext === 'mp4' || ext === 'webm') return ext;
        return 'unknown';
    }

    loadHLS(url) {
        if (!window.Hls) {
            console.error('[Player] HLS.js Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½');
            return;
        }

        if (!Hls.isSupported()) {
            if (this.video.canPlayType('application/vnd.apple.mpegurl')) {
                this.loadNative(url);
                return;
            }
            console.error('[Player] HLS Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ');
            return;
        }

        // ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ·Ñ‡Ð¸Ðº Ñ Ð¿Ñ€Ð¾ÐºÑÐ¸
        class ProxyLoader extends Hls.DefaultConfig.loader {
            constructor(config) {
                super(config);
            }

            load(context, config, callbacks) {
                const originalUrl = context.url;

                if (!originalUrl.includes('localhost') && !originalUrl.includes('127.0.0.1') && !originalUrl.includes('proxy.php')) {
                    context.url = './proxy.php?url=' + encodeURIComponent(originalUrl);
                }

                const originalOnSuccess = callbacks.onSuccess;
                callbacks.onSuccess = (response, stats, ctx) => {
                    response.url = originalUrl;
                    originalOnSuccess(response, stats, ctx);
                };

                super.load(context, config, callbacks);
            }
        }

        // ========================================
        // YOUTUBE-STYLE ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯ HLS
        // ÐŸÐ»Ð°Ð²Ð½Ð¾Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ + ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ
        // ========================================
        this.hls = new Hls({
            // ===== ÐžÐ‘Ð©Ð˜Ð• ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ =====
            debug: false,
            enableWorker: true,
            lowLatencyMode: false,

            // ===== Ð‘Ð£Ð¤Ð•Ð Ð˜Ð—ÐÐ¦Ð˜Ð¯ (YouTube-style) =====
            // ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð±ÑƒÑ„ÐµÑ€: 30s Ð²Ð¿ÐµÑ€Ñ‘Ð´
            maxBufferLength: 30,
            maxMaxBufferLength: 60,
            maxBufferSize: 100 * 1000 * 1000,  // 100 MB

            // Ð—Ð°Ð´Ð½Ð¸Ð¹ Ð±ÑƒÑ„ÐµÑ€: 30s Ð½Ð°Ð·Ð°Ð´ (Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼Ð¾Ñ‚ÐºÐ¸)
            backBufferLength: 30,

            // ÐŸÑ€Ð¾Ð±ÐµÐ»Ñ‹ Ð² Ð±ÑƒÑ„ÐµÑ€Ðµ
            maxBufferHole: 0.5,  // ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð±ÐµÐ» 0.5s

            // Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð±ÑƒÑ„ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸
            highBufferWatchdogPeriod: 2,  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2s

            // ===== ÐŸÐ›ÐÐ’ÐÐžÐ• ÐŸÐ•Ð Ð•ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• ÐšÐÐ§Ð•Ð¡Ð¢Ð’Ð =====
            // ÐŸÑ€Ð¸ ÑÐ¼ÐµÐ½Ðµ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° Ð´ÐµÑ€Ð¶Ð¸Ð¼ Ð·Ð°Ð¿Ð°Ñ 5s
            maxBufferSize: 100 * 1000 * 1000,

            // ABR (Adaptive Bitrate) Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
            abrEwmaDefaultEstimate: 500000,  // ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð¾Ñ†ÐµÐ½ÐºÐ° ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸
            abrEwmaSlowVoD: 3,               // ÐœÐµÐ´Ð»ÐµÐ½Ð½Ð°Ñ Ð°Ð´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ VOD
            abrEwmaFastVoD: 3,               // Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð°Ð´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ VOD
            abrBandWidthFactor: 0.95,        // Ð—Ð°Ð¿Ð°Ñ 5% Ð¿Ñ€Ð¸ Ð²Ñ‹Ð±Ð¾Ñ€Ðµ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°
            abrBandWidthUpFactor: 0.7,       // ÐšÐ¾Ð½ÑÐµÑ€Ð²Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ðµ Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ðµ
            abrMaxWithRealBitrate: true,     // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ bitrate

            // ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°
            startLevel: -1,                  // ÐÐ²Ñ‚Ð¾-Ð²Ñ‹Ð±Ð¾Ñ€ Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ðµ
            autoLevelCapping: -1,            // Ð‘ÐµÐ· Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ð¹
            minAutoBitrate: 0,               // ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ bitrate
            capLevelToPlayerSize: false,     // ÐÐµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñƒ Ð¿Ð»ÐµÐµÑ€Ð°

            // ===== Ð—ÐÐ“Ð Ð£Ð—ÐšÐ Ð¡Ð•Ð“ÐœÐ•ÐÐ¢ÐžÐ’ =====
            // ÐŸÑ€ÐµÐ´Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð»Ñ Ð¿Ð»Ð°Ð²Ð½Ð¾ÑÑ‚Ð¸
            startFragPrefetch: true,         // ÐŸÑ€ÐµÐ´Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚
            progressive: true,               // ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°

            // Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ñ‹ Ð¸ retry
            manifestLoadingTimeOut: 10000,   // 10s Ð½Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð¼Ð°Ð½Ð¸Ñ„ÐµÑÑ‚Ð°
            manifestLoadingMaxRetry: 4,      // 4 Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ¸
            manifestLoadingRetryDelay: 1000, // 1s Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ°Ð¼Ð¸
            manifestLoadingMaxRetryTimeout: 64000,

            levelLoadingTimeOut: 10000,      // 10s Ð½Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ ÑƒÑ€Ð¾Ð²Ð½Ñ
            levelLoadingMaxRetry: 4,
            levelLoadingRetryDelay: 1000,
            levelLoadingMaxRetryTimeout: 64000,

            fragLoadingTimeOut: 20000,       // 20s Ð½Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°
            fragLoadingMaxRetry: 6,          // 6 Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð¾Ðº
            fragLoadingRetryDelay: 1000,     // 1s Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ°Ð¼Ð¸
            fragLoadingMaxRetryTimeout: 64000,

            // ===== ÐžÐ‘Ð ÐÐ‘ÐžÐ¢ÐšÐ ÐžÐ¨Ð˜Ð‘ÐžÐš =====
            // ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð¾Ðº Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
            appendErrorMaxRetry: 3,

            // Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…
            maxLoadingDelay: 4,
            maxStarvationDelay: 4,

            // ===== SEEK Ð˜ ÐŸÐ•Ð Ð•ÐœÐžÐ¢ÐšÐ =====
            // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð¾Ð² Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ¼Ð¾Ñ‚ÐºÐµ
            seekHoleNudgeDuration: 0.1,
            maxSeekHole: 2,
            nudgeOffset: 0.1,
            nudgeMaxRetry: 3,

            // ===== FPS Ð˜ Ð¡Ð˜ÐÐ¥Ð ÐžÐÐ˜Ð—ÐÐ¦Ð˜Ð¯ =====
            maxFragLookUpTolerance: 0.25,
            maxAudioFramesDrift: 1,

            // ===== ÐŸÐ ÐžÐšÐ¡Ð˜ =====
            loader: ProxyLoader,

            // ===== Ð”ÐžÐŸÐžÐ›ÐÐ˜Ð¢Ð•Ð›Ð¬ÐÐž =====
            // Ð–Ð¸Ð²Ñ‹Ðµ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¸
            liveSyncDurationCount: 3,
            liveMaxLatencyDurationCount: Infinity,

            // Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸
            enableSoftwareAES: true,

            // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¾Ð²
            stretchShortVideoTrack: false,
            maxFragLookUpTolerance: 0.25,

            // DRM (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)
            emeEnabled: false
        });

        let sourceUrl = url;
        if (url.includes('proxy.php?url=')) {
            const match = url.match(/[?&]url=([^&]+)/);
            if (match) sourceUrl = decodeURIComponent(match[1]);
        }

        console.log('[Player] Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° HLS (YouTube-optimized):', sourceUrl);
        this.hls.loadSource(sourceUrl);
        this.hls.attachMedia(this.video);

        // Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ HLS
        this.hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
            console.log('[Player] ÐœÐ°Ð½Ð¸Ñ„ÐµÑÑ‚ Ñ€Ð°ÑÐ¿Ð°Ñ€ÑÐµÐ½', data);
            this.updateQualities(data.levels);
            this.emit('manifestparsed', data);
            if (this.config.autoplay) this.play();
        });

        this.hls.on(Hls.Events.AUDIO_TRACKS_UPDATED, (event, data) => {
            console.log('[Player] ÐÑƒÐ´Ð¸Ð¾-Ð´Ð¾Ñ€Ð¾Ð¶ÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹', data);
            this.emit('manifestparsed', data);
        });

        this.hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
            const level = this.hls.levels[data.level];
            this.state.currentQuality = {
                height: level.height,
                bitrate: level.bitrate,
                codec: level.codecSet
            };
            console.log(`[Player] ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾: ${level.height}p, ${(level.bitrate / 1000).toFixed(0)} kbps`);
                    case 'bufferStalledError':
            console.log('[Player] â¸ Ð‘ÑƒÑ„ÐµÑ€ Ð·Ð°ÑÑ‚Ñ€ÑÐ», Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ...');
            // ÐŸÐ¾Ð½Ð¸Ð¶Ð°ÐµÐ¼ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð»Ñ ÑƒÑÐºÐ¾Ñ€ÐµÐ½Ð¸Ñ Ð±ÑƒÑ„ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸
            if (this.hls.currentLevel > 0) {
                const newLevel = Math.max(0, this.hls.currentLevel - 1);
                console.log(`[Player] ÐŸÐ¾Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°: ${this.hls.levels[this.hls.currentLevel].height}p â†’ ${this.hls.levels[newLevel].height}p`);
                this.hls.currentLevel = newLevel;
            }
            // ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸
            this.hls.startLoad();
            break;

                    case 'bufferAppendingError':
            console.log('[Player] ðŸ”„ ÐžÑˆÐ¸Ð±ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð±ÑƒÑ„ÐµÑ€Ð°, retry...');
            break;

                    case 'fragLoadError':
            console.log('[Player] ðŸ”„ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°, retry...');
            break;

                    default:
        console.warn('[Player] âš  Non-fatal Ð¾ÑˆÐ¸Ð±ÐºÐ°:', data.details);
}
            }

this.emit('error', data);
        });

this.currentEngine = 'hls';
    }

loadDASH(url) {
    if (!window.dashjs) {
        console.error('[Player] Dash.js Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½');
        return;
    }

    this.dash = dashjs.MediaPlayer().create();
    this.dash.initialize(this.video, url, this.config.autoplay);

    this.dash.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, () => {
        console.log('[Player] DASH Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½');
        this.emit('manifestparsed');
    });

    this.currentEngine = 'dash';
}

loadNative(url) {
    this.video.src = url;
    this.currentEngine = 'native';
    if (this.config.autoplay) this.play();
}

updateQualities(levels) {
    this.state.availableQualities = levels.map((level, index) => ({
        index,
        height: level.height,
        width: level.width,
        bitrate: level.bitrate,
        codec: level.codecSet,
        label: `${level.height}p`
    }));
}

updateBuffered() {
    const buffered = [];
    for (let i = 0; i < this.video.buffered.length; i++) {
        buffered.push({
            start: this.video.buffered.start(i),
            end: this.video.buffered.end(i)
        });
    }
    this.state.buffered = buffered;
}

// API
play() { return this.video.play(); }
pause() { this.video.pause(); }
togglePlay() { this.state.isPlaying ? this.pause() : this.play(); }
seek(time) { this.video.currentTime = time; }
setVolume(volume) { this.video.volume = Math.max(0, Math.min(1, volume)); }
toggleMute() { this.video.muted = !this.video.muted; }
setPlaybackRate(rate) { this.video.playbackRate = rate; }
setQuality(index) {
    if (this.hls) {
        console.log('[Player] Setting quality to index:', index, this.hls.levels[index]);
        this.hls.currentLevel = index;
    } else {
        console.warn('[Player] HLS not initialized');
    }
}
setAutoQuality() {
    if (this.hls) {
        console.log('[Player] Setting auto quality');
        this.hls.currentLevel = -1;
    } else {
        console.warn('[Player] HLS not initialized');
    }
}
getState() { return { ...this.state }; }

// Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ
on(event, handler) {
    if (!this.eventHandlers.has(event)) this.eventHandlers.set(event, []);
    this.eventHandlers.get(event).push(handler);
}

off(event, handler) {
    if (!this.eventHandlers.has(event)) return;
    const handlers = this.eventHandlers.get(event);
    const index = handlers.indexOf(handler);
    if (index > -1) handlers.splice(index, 1);
}

emit(event, data) {
    if (!this.eventHandlers.has(event)) return;
    this.eventHandlers.get(event).forEach(handler => handler(data));
}

cleanup() {
    if (this.hls) {
        this.hls.destroy();
        this.hls = null;
    }
    if (this.dash) {
        this.dash.reset();
        this.dash = null;
    }
}

destroy() {
    this.cleanup();
    this.video.removeAttribute('src');
    this.video.load();
    this.eventHandlers.clear();
}
}

if (typeof module !== 'undefined' && module.exports) {
    module.exports = ProVideoPlayer;
}
